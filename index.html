<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon-Shot AR | AI Insight</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #video-overlay { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            object-fit: cover; transform: scaleX(-1); z-index: -1; 
        }
        .neon-text { text-shadow: 0 0 10px #0ff, 0 0 20px #0ff; }
        .hud-panel { background: rgba(0, 20, 40, 0.6); backdrop-filter: blur(8px); border: 1px solid #0ff; }
    </style>
</head>
<body>
    <video id="video-overlay" autoplay playsinline></video>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [status, setStatus] = useState('ĐANG KHỞI TẠO AI...');
            const [score, setScore] = useState(0);
            const scoreRef = useRef(0);

            useEffect(() => {
                const initGame = async () => {
                    const videoElement = document.getElementById('video-overlay');
                    
                    // 1. Cấu hình MediaPipe Hands
                    const hands = new Hands({
                        locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`
                    });

                    hands.setOptions({
                        maxNumHands: 1,
                        modelComplexity: 1,
                        minDetectionConfidence: 0.7,
                        minTrackingConfidence: 0.7
                    });

                    // 2. Cấu hình Three.js
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    document.body.appendChild(renderer.domElement);

                    // Tạo tâm ngắm (Crosshair)
                    const crosshair = new THREE.Mesh(
                        new THREE.RingGeometry(0.08, 0.1, 32),
                        new THREE.MeshBasicMaterial({ color: 0x00ffff })
                    );
                    crosshair.position.z = -5;
                    scene.add(crosshair);

                    // Xử lý khi có kết quả từ AI
                    hands.onResults((results) => {
                        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                            setStatus('SẴN SÀNG - GIƠ TAY LÊN!');
                            const indexTip = results.multiHandLandmarks[0][8]; // Đầu ngón trỏ
                            
                            // Di chuyển tâm ngắm theo ngón tay
                            crosshair.position.x = (0.5 - indexTip.x) * 12;
                            crosshair.position.y = (0.5 - indexTip.y) * 8;
                        } else {
                            setStatus('ĐANG TÌM BÀN TAY...');
                        }
                    });

                    // 3. Chạy Camera
                    const cam = new Camera(videoElement, {
                        onFrame: async () => {
                            await hands.send({ image: videoElement });
                        },
                        width: 1280,
                        height: 720
                    });

                    try {
                        await cam.start();
                        setStatus('HÃY CHO PHÉP TRUY CẬP CAMERA');
                    } catch (e) {
                        setStatus('LỖI CAMERA: VUI LÒNG BẬT QUYỀN TRUY CẬP');
                    }

                    const animate = () => {
                        requestAnimationFrame(animate);
                        renderer.render(scene, camera);
                    };
                    animate();
                };

                initGame();
            }, []);

            return (
                <div className="fixed inset-0 pointer-events-none text-white p-8">
                    <div className="flex justify-between items-start">
                        <div className="hud-panel p-4 rounded-xl">
                            <p className="text-xs text-cyan-400 uppercase tracking-widest">Score</p>
                            <p className="text-4xl font-bold neon-text">{score}</p>
                        </div>
                        <div className="bg-cyan-500/20 px-6 py-2 rounded-full border border-cyan-500/50">
                            <span className="animate-pulse mr-2">●</span> {status}
                        </div>
                    </div>
                    <div className="absolute bottom-10 left-1/2 -translate-x-1/2 opacity-30 text-xs">
                        AIINSIGHT.VN | AR GESTURE v2.0
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
